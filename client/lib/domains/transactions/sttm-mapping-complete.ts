// Transactions Domain - COMPLETE Source to Target Mapping (STTM) - 100% Coverage
// Includes: Direct mappings + Derived/Calculated + System/Audit + Compliance/Fraud

export interface ColumnMapping {
  sourceSystem: string;
  sourceTable: string;
  sourceColumn: string;
  bronzeSchema: string;
  bronzeTable: string;
  bronzeColumn: string;
  silverSchema: string;
  silverTable: string;
  silverColumn: string;
  goldSchema: string;
  goldTable: string;
  goldColumn: string | null;
  dataType: string;
  businessLogic: string;
  businessMeaning: string;
  mappingType?: "Direct" | "Derived" | "System" | "Compliance" | "Fraud";
}

// Import existing mappings
import {
  moneyTransactionMappings,
  maintenanceLogMappings,
  stopPaymentMappings,
  holdTransactionMappings,
} from "./sttm-mapping";

// ============================================================================
// DERIVED & ENRICHED COLUMNS - FCT_DEPOSIT_CERTIFICATE_TRANSACTION
// ============================================================================
export const transactionsDerivedMappings: ColumnMapping[] = [
  {
    sourceSystem: "SYSTEM",
    sourceTable: "N/A",
    sourceColumn: "AUTO_GENERATED",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "TRANSACTION_SK",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "BIGINT",
    businessLogic: "Auto-generated surrogate key",
    businessMeaning: "Surrogate key for transaction fact table",
    mappingType: "System",
  },
  {
    sourceSystem: "SYSTEM",
    sourceTable: "N/A",
    sourceColumn: "UUID_STRING()",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "TRANSACTION_UUID",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "STRING",
    businessLogic: "Generated for distributed systems",
    businessMeaning: "Global unique identifier for transaction",
    mappingType: "System",
  },
  {
    sourceSystem: "REFERENCE_DATA",
    sourceTable: "DIM_ACCOUNT",
    sourceColumn: "PRIMARY_CUSTOMER_ID",
    bronzeSchema: "CORE_DEPOSIT",
    bronzeTable: "DIM_ACCOUNT",
    bronzeColumn: "PRIMARY_CUSTOMER_ID",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "CUSTOMER_ID",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "VARCHAR(20)",
    businessLogic: "Lookup from DIM_ACCOUNT using account_id",
    businessMeaning: "Primary account owner customer ID",
    mappingType: "Derived",
  },
  {
    sourceSystem: "FIS-ADS",
    sourceTable: "TB_DP_OZO_MNY_TXN_ARD",
    sourceColumn: "TRN_TRANS_AMT, TRN_TRANS_TYP",
    bronzeSchema: "FIS_ADS",
    bronzeTable: "TB_DP_OZO_MNY_TXN_ARD",
    bronzeColumn: "MULTIPLE",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "SIGNED_AMOUNT",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "DECIMAL(18,2)",
    businessLogic: "TRN_TRANS_AMT * CASE WHEN TRN_TRANS_TYP='D' THEN -1 ELSE 1 END",
    businessMeaning: "Signed amount: negative for debits, positive for credits",
    mappingType: "Derived",
  },
  {
    sourceSystem: "REFERENCE_DATA",
    sourceTable: "REF_TRANSACTION_TYPE_MAPPING",
    sourceColumn: "STANDARD_TYPE",
    bronzeSchema: "N/A",
    bronzeTable: "REF_TRANSACTION_TYPE_MAPPING",
    bronzeColumn: "STANDARD_TYPE",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "TRANSACTION_TYPE_STANDARD",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "VARCHAR(50)",
    businessLogic: "Map source codes to standard types: CHECK, ACH, WIRE, TRANSFER, ATM, etc.",
    businessMeaning: "Standard transaction type across all sources",
    mappingType: "Derived",
  },
  {
    sourceSystem: "FIS-ADS",
    sourceTable: "TB_DP_OZO_MNY_TXN_ARD",
    sourceColumn: "TRN_TRANS_CDE",
    bronzeSchema: "FIS_ADS",
    bronzeTable: "TB_DP_OZO_MNY_TXN_ARD",
    bronzeColumn: "TRN_TRANS_CDE",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "TRANSACTION_CATEGORY",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "VARCHAR(50)",
    businessLogic: "Derived from transaction_type_standard and direction: OUTGOING, INCOMING, INTERNAL",
    businessMeaning: "Business category for analytics",
    mappingType: "Derived",
  },
  {
    sourceSystem: "FIS-ADS",
    sourceTable: "TB_DP_OZO_MNY_TXN_ARD",
    sourceColumn: "TRN_TRANS_CDE",
    bronzeSchema: "FIS_ADS",
    bronzeTable: "TB_DP_OZO_MNY_TXN_ARD",
    bronzeColumn: "TRN_TRANS_CDE",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "TRANSACTION_CHANNEL",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "VARCHAR(50)",
    businessLogic: "Derived from transaction type: TELLER, ATM, ONLINE, MOBILE, ACH, WIRE",
    businessMeaning: "Channel through which transaction was initiated",
    mappingType: "Derived",
  },
  {
    sourceSystem: "REFERENCE_DATA",
    sourceTable: "REF_BUSINESS_CALENDAR",
    sourceColumn: "IS_BUSINESS_DAY",
    bronzeSchema: "N/A",
    bronzeTable: "REF_BUSINESS_CALENDAR",
    bronzeColumn: "IS_BUSINESS_DAY",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "BUSINESS_DAY_INDICATOR",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "BOOLEAN",
    businessLogic: "Lookup in business calendar using transaction_date",
    businessMeaning: "Whether transaction_date is a business day",
    mappingType: "Derived",
  },
];

// ============================================================================
// COMPLIANCE & FRAUD DETECTION COLUMNS
// ============================================================================
export const transactionsComplianceMappings: ColumnMapping[] = [
  {
    sourceSystem: "COMPLIANCE_SYSTEM",
    sourceTable: "OFAC_SCREENING",
    sourceColumn: "SCREENING_STATUS",
    bronzeSchema: "N/A",
    bronzeTable: "OFAC_SCREENING",
    bronzeColumn: "SCREENING_STATUS",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "OFAC_SCREENING_STATUS",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "VARCHAR(50)",
    businessLogic: "Result from OFAC screening service: PASS, FAIL, HOLD, REVIEW",
    businessMeaning: "OFAC screening result for compliance",
    mappingType: "Compliance",
  },
  {
    sourceSystem: "AML_MONITORING",
    sourceTable: "AML_ALERTS",
    sourceColumn: "ALERT_FLAG",
    bronzeSchema: "N/A",
    bronzeTable: "AML_ALERTS",
    bronzeColumn: "ALERT_FLAG",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "AML_ALERT_FLAG",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "BOOLEAN",
    businessLogic: "TRUE if transaction triggered AML monitoring rules",
    businessMeaning: "Whether transaction triggered AML alert",
    mappingType: "Compliance",
  },
  {
    sourceSystem: "SYSTEM",
    sourceTable: "N/A",
    sourceColumn: "AMOUNT_THRESHOLD",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "HIGH_VALUE_TRANSACTION",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "BOOLEAN",
    businessLogic: "transaction_amount >= 10000",
    businessMeaning: "Whether transaction exceeds threshold ($10,000)",
    mappingType: "Derived",
  },
  {
    sourceSystem: "SYSTEM",
    sourceTable: "N/A",
    sourceColumn: "CTR_LOGIC",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "CTC_REPORTABLE",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "BOOLEAN",
    businessLogic: "high_value_transaction = TRUE AND customer not exempt",
    businessMeaning: "Whether transaction requires CTR reporting (>$10K)",
    mappingType: "Compliance",
  },
  {
    sourceSystem: "FRAUD_MODEL",
    sourceTable: "FRAUD_DETECTION_ENGINE",
    sourceColumn: "RISK_SCORE",
    bronzeSchema: "N/A",
    bronzeTable: "FRAUD_DETECTION_ENGINE",
    bronzeColumn: "RISK_SCORE",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "FRAUD_RISK_SCORE",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "DECIMAL(5,2)",
    businessLogic: "Fraud risk score 0-100 from ML model, higher = more risky",
    businessMeaning: "Fraud risk score calculated by fraud detection model",
    mappingType: "Fraud",
  },
  {
    sourceSystem: "FRAUD_MODEL",
    sourceTable: "FRAUD_DETECTION_ENGINE",
    sourceColumn: "RULE_HITS",
    bronzeSchema: "N/A",
    bronzeTable: "FRAUD_DETECTION_ENGINE",
    bronzeColumn: "RULE_HITS",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "FRAUD_RULE_HITS",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "INTEGER",
    businessLogic: "Count of fraud rules triggered by this transaction",
    businessMeaning: "Number of fraud rules triggered",
    mappingType: "Fraud",
  },
  {
    sourceSystem: "FRAUD_MODEL",
    sourceTable: "FRAUD_DETECTION_ENGINE",
    sourceColumn: "IS_SUSPICIOUS",
    bronzeSchema: "N/A",
    bronzeTable: "FRAUD_DETECTION_ENGINE",
    bronzeColumn: "IS_SUSPICIOUS",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "IS_SUSPICIOUS",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "BOOLEAN",
    businessLogic: "fraud_risk_score > 70 OR fraud_rule_hits > 0",
    businessMeaning: "Whether transaction flagged as suspicious",
    mappingType: "Fraud",
  },
];

// ============================================================================
// BALANCE & RUNNING TOTALS
// ============================================================================
export const transactionsBalanceMappings: ColumnMapping[] = [
  {
    sourceSystem: "DERIVED",
    sourceTable: "FCT_DEPOSIT_DAILY_BALANCE",
    sourceColumn: "CLOSING_BALANCE",
    bronzeSchema: "CORE_TRANSACTIONS",
    bronzeTable: "FCT_DEPOSIT_DAILY_BALANCE",
    bronzeColumn: "CLOSING_BALANCE",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "BALANCE_BEFORE",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "DECIMAL(18,2)",
    businessLogic: "Previous day balance + SUM(signed_amount) of intervening transactions",
    businessMeaning: "Account balance before this transaction",
    mappingType: "Derived",
  },
  {
    sourceSystem: "DERIVED",
    sourceTable: "CALCULATED",
    sourceColumn: "BALANCE_BEFORE + SIGNED_AMOUNT",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "BALANCE_AFTER",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "DECIMAL(18,2)",
    businessLogic: "balance_before + signed_amount",
    businessMeaning: "Account balance after this transaction",
    mappingType: "Derived",
  },
  {
    sourceSystem: "DERIVED",
    sourceTable: "CALCULATED",
    sourceColumn: "BALANCE_LOGIC",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "OVERDRAFT_FLAG",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "BOOLEAN",
    businessLogic: "balance_after < 0 AND balance_before >= 0",
    businessMeaning: "Whether transaction caused overdraft",
    mappingType: "Derived",
  },
];

// ============================================================================
// SYSTEM & AUDIT COLUMNS
// ============================================================================
export const transactionsSystemMappings: ColumnMapping[] = [
  {
    sourceSystem: "SYSTEM",
    sourceTable: "N/A",
    sourceColumn: "CURRENT_TIMESTAMP",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "CREATED_TIMESTAMP",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "TIMESTAMP_NTZ",
    businessLogic: "CURRENT_TIMESTAMP() on insert",
    businessMeaning: "Record creation timestamp",
    mappingType: "System",
  },
  {
    sourceSystem: "SYSTEM",
    sourceTable: "N/A",
    sourceColumn: "CURRENT_TIMESTAMP",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "UPDATED_TIMESTAMP",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "TIMESTAMP_NTZ",
    businessLogic: "CURRENT_TIMESTAMP() on update",
    businessMeaning: "Record last update timestamp",
    mappingType: "System",
  },
  {
    sourceSystem: "DATA_QUALITY",
    sourceTable: "DQ_ENGINE",
    sourceColumn: "QUALITY_SCORE",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    silverColumn: "DATA_QUALITY_SCORE",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "DECIMAL(5,2)",
    businessLogic: "Based on completeness and validation",
    businessMeaning: "Data quality score 0-100",
    mappingType: "Derived",
  },
];

// ============================================================================
// AGGREGATION TABLE MAPPINGS - TRANSACTION_DAILY_AGGREGATES
// ============================================================================
export const transactionsAggregationMappings: ColumnMapping[] = [
  {
    sourceSystem: "SYSTEM",
    sourceTable: "N/A",
    sourceColumn: "AUTO_GENERATED",
    bronzeSchema: "N/A",
    bronzeTable: "N/A",
    bronzeColumn: "N/A",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "TRANSACTION_DAILY_AGGREGATES",
    silverColumn: "DAILY_AGGREGATE_SK",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "BIGINT",
    businessLogic: "Auto-generated surrogate key",
    businessMeaning: "Surrogate key for daily aggregates",
    mappingType: "System",
  },
  {
    sourceSystem: "SILVER_AGGREGATION",
    sourceTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    sourceColumn: "COUNT(*)",
    bronzeSchema: "CORE_TRANSACTIONS",
    bronzeTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    bronzeColumn: "MULTIPLE",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "TRANSACTION_DAILY_AGGREGATES",
    silverColumn: "TOTAL_TRANSACTIONS",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "INTEGER",
    businessLogic: "COUNT(*) GROUP BY account_id, transaction_date, transaction_type_standard",
    businessMeaning: "Count of transactions by account, date, and type",
    mappingType: "Derived",
  },
  {
    sourceSystem: "SILVER_AGGREGATION",
    sourceTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    sourceColumn: "SUM(signed_amount)",
    bronzeSchema: "CORE_TRANSACTIONS",
    bronzeTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION",
    bronzeColumn: "SIGNED_AMOUNT",
    silverSchema: "CORE_DEPOSIT",
    silverTable: "TRANSACTION_DAILY_AGGREGATES",
    silverColumn: "TOTAL_AMOUNT",
    goldSchema: "ANALYTICS",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
    goldColumn: null,
    dataType: "DECIMAL(18,2)",
    businessLogic: "SUM(signed_amount) GROUP BY account_id, transaction_date, transaction_type_standard",
    businessMeaning: "Total signed amount for transactions",
    mappingType: "Derived",
  },
];

// ============================================================================
// COMBINE ALL TRANSACTIONS STTM MAPPINGS - 100% Coverage
// ============================================================================
export const transactionsSTTMMapping_Complete: ColumnMapping[] = [
  ...moneyTransactionMappings,
  ...maintenanceLogMappings,
  ...stopPaymentMappings,
  ...holdTransactionMappings,
  ...transactionsDerivedMappings,
  ...transactionsComplianceMappings,
  ...transactionsBalanceMappings,
  ...transactionsSystemMappings,
  ...transactionsAggregationMappings,
];

export const transactionsSTTMGaps_Complete: ColumnMapping[] = [];

export const transactionsTableCoverage_Complete = [
  {
    fisTable: "TB_DP_OZO_MNY_TXN_ARD + DERIVED",
    columnCount: 84,
    mappedCount: 84,
    coverage: "100%",
    businessKey: "TRN_TRANS_TME_SEQ",
    silverTable: "FCT_DEPOSIT_CERTIFICATE_TRANSACTION, TRANSACTION_DAILY_AGGREGATES",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
  },
  {
    fisTable: "TB_DP_OZU_MAINT_ARD",
    columnCount: 8,
    mappedCount: 8,
    coverage: "100%",
    businessKey: "LG_TRANS_TME_SEQ",
    silverTable: "FCT_DEPOSIT_MAINTENANCE_TRANSACTION, FCT_DEPOSIT_HOLD_TRANSACTION",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
  },
  {
    fisTable: "TB_DP_OZQ_STP_ARD",
    columnCount: 5,
    mappedCount: 5,
    coverage: "100%",
    businessKey: "STP_ID",
    silverTable: "FCT_DEPOSIT_STOP_TRANSACTION",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
  },
  {
    fisTable: "TB_DP_OZV_HLD_ARD",
    columnCount: 6,
    mappedCount: 6,
    coverage: "100%",
    businessKey: "HD_ID",
    silverTable: "FCT_DEPOSIT_HOLD_TRANSACTION",
    goldTable: "CUSTOMER_DEPOSIT_AGGR",
  },
];

export default transactionsSTTMMapping_Complete;
